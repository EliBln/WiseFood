// @undecaf/barcode-detector-polyfill@0.9.21 downloaded from https://ga.jspm.io/npm:@undecaf/barcode-detector-polyfill@0.9.21/dist/main.js

import{ZBarConfigType as e,ZBarSymbolType as n,scanRGBABuffer as r,getDefaultScanner as d}from"https://cdn.jsdelivr.net/npm/@undecaf/zbar-wasm@0.9.15/dist/main.js";function a(e,n,r,d){return new(r||(r=Promise))((function(f,h){function s(e){try{c(d.next(e))}catch(e){h(e)}}function o(e){try{c(d.throw(e))}catch(e){h(e)}}function c(e){var n;e.done?f(e.value):(n=e.value,n instanceof r?n:new r((function(e){e(n)}))).then(s,o)}c((d=d.apply(e,n||[])).next())}))}class i{constructor(n,r=e.ZBAR_CFG_ENABLE,d=1){this.symbolType=n,this.configType=r,this.number=d,this.configSteps=[this]}static register(e,n,r=n.symbolType){return i.formatsToConfigs[e]=n,i.typesToFormats[r]=i.typesToFormats[r]||e,n}static formats(){return Object.keys(i.formatsToConfigs)}static toFormat(e){return i.typesToFormats[e]}static configure(e,n){var r;null===(r=i.formatsToConfigs[n])||void 0===r||r.configSteps.forEach((n=>e.setConfig(n.symbolType,n.configType,n.number)))}add(e){return this.configSteps.push(e),this}}var f;i.formatsToConfigs={},i.typesToFormats={},i.register("codabar",new i(n.ZBAR_CODABAR)),i.register("code_39",new i(n.ZBAR_CODE39)),i.register("code_93",new i(n.ZBAR_CODE93)),i.register("code_128",new i(n.ZBAR_CODE128)),i.register("databar",new i(n.ZBAR_DATABAR)),i.register("databar_exp",new i(n.ZBAR_DATABAR_EXP)),i.register("ean_2",new i(n.ZBAR_EAN2)),i.register("ean_5",new i(n.ZBAR_EAN5)),i.register("ean_8",new i(n.ZBAR_EAN8)),i.register("ean_13",new i(n.ZBAR_EAN13)),i.register("ean_13+2",new i(n.ZBAR_EAN13)).add(new i(n.ZBAR_EAN2)),i.register("ean_13+5",new i(n.ZBAR_EAN13)).add(new i(n.ZBAR_EAN5)),i.register("isbn_10",new i(n.ZBAR_ISBN10)).add(new i(n.ZBAR_EAN13)),i.register("isbn_13",new i(n.ZBAR_ISBN13)).add(new i(n.ZBAR_EAN13)),i.register("isbn_13+2",new i(n.ZBAR_ISBN13)).add(new i(n.ZBAR_EAN13)).add(new i(n.ZBAR_EAN2)),i.register("isbn_13+5",new i(n.ZBAR_ISBN13)).add(new i(n.ZBAR_EAN13)).add(new i(n.ZBAR_EAN5)),i.register("itf",new i(n.ZBAR_I25)),i.register("qr_code",new i(n.ZBAR_QRCODE)),i.register("sq_code",new i(n.ZBAR_SQCODE)),i.register("upc_a",new i(n.ZBAR_UPCA)).add(new i(n.ZBAR_EAN13)),i.register("upc_e",new i(n.ZBAR_UPCE)).add(new i(n.ZBAR_EAN13)),function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.UPRIGHT=0]="UPRIGHT",e[e.ROTATED_RIGHT=1]="ROTATED_RIGHT",e[e.UPSIDE_DOWN=2]="UPSIDE_DOWN",e[e.ROTATED_LEFT=3]="ROTATED_LEFT"}(f||(f={}));class o{}const h=(()=>{try{return new OffscreenCanvas(1,1).getContext("2d")instanceof OffscreenCanvasRenderingContext2D}catch(e){return!1}})();class m{constructor(e={}){if(void 0!==e.formats){if(!Array.isArray(e.formats)||!e.formats.length)throw new TypeError(`Barcode formats should be a non-empty array of strings but are: ${JSON.stringify(e)}`);const n=e.formats.filter((e=>!i.formats().includes(e)));if(n.length)throw new TypeError(`Unsupported barcode format(s): ${n.join(", ")}`)}this.formats=e.formats||i.formats(),this.zbarConfig=e.zbar||new o}static getSupportedFormats(){return Promise.resolve(i.formats())}detect(e){if(!m.isImageBitmapSource(e))throw new TypeError("BarcodeDetector.detect() argument is not an ImageBitmapSource");const n=m.intrinsicDimensions(e);if(0===n.width||0===n.height)return Promise.resolve([]);try{return Promise.all([this.toImageData(e),this.getScanner()]).then((e=>{const n=e[0],d=e[1];return void 0!==this.zbarConfig.enableCache&&d.enableCache(this.zbarConfig.enableCache),r(n.data,n.width,n.height,d)})).then((e=>e.map((e=>this.toBarcodeDetectorResult(e)))))}catch(e){return Promise.reject(e)}}getScanner(){return new Promise(((r,f)=>a(this,void 0,void 0,(function*(){if(!this.scanner){const r=yield d();this.formats.length>0&&(r.setConfig(n.ZBAR_NONE,e.ZBAR_CFG_ENABLE,0),this.formats.forEach((e=>i.configure(r,e)))),this.scanner=r}r(this.scanner)}))))}toImageData(e){const t=e=>{const n=m.intrinsicDimensions(e);this.canvas&&this.canvas.width===n.width&&this.canvas.height===n.height||(this.canvas=function(e,n){if(h)return new OffscreenCanvas(e,n);{const r=document.createElement("canvas");return r.width=e,r.height=n,r}}(n.width,n.height));const r=this.canvas,d=r.getContext("2d");return d.drawImage(e,0,0),d.getImageData(0,0,r.width,r.height)};if(e instanceof ImageData)return Promise.resolve(e);if(e instanceof Blob){const n=document.createElement("img");return n.src=URL.createObjectURL(e),n.decode().then((()=>t(n))).finally((()=>URL.revokeObjectURL(n.src)))}return e instanceof CanvasRenderingContext2D?Promise.resolve(e.getImageData(0,0,e.canvas.width,e.canvas.height)):Promise.resolve(t(e))}toBarcodeDetectorResult(e){const n={minX:1/0,maxX:-1/0,minY:1/0,maxY:-1/0};e.points.forEach((e=>{n.minX=Math.min(n.minX,e.x),n.maxX=Math.max(n.maxX,e.x),n.minY=Math.min(n.minY,e.y),n.maxY=Math.max(n.maxY,e.y)}));return{format:i.toFormat(e.type),rawValue:e.decode(this.zbarConfig.encoding),orientation:e.orientation,quality:e.quality,boundingBox:DOMRectReadOnly.fromRect({x:n.minX,y:n.minY,width:n.maxX-n.minX,height:n.maxY-n.minY}),cornerPoints:[{x:n.minX,y:n.minY},{x:n.maxX,y:n.minY},{x:n.maxX,y:n.maxY},{x:n.minX,y:n.maxY}]}}static isImageBitmapSource(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof CanvasRenderingContext2D&&e instanceof CanvasRenderingContext2D||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||e instanceof ImageData||e instanceof Blob||e&&0==e.width||e&&0==e.height}static intrinsicDimensions(e){return{width:Number(e.naturalWidth||e.videoWidth||e.width),height:Number(e.naturalHeight||e.videoHeight||e.height)}}}const g="@undecaf/zbar-wasm",A="0.9.15",u="https://cdn.jsdelivr.net/npm/@undecaf/zbar-wasm@0.9.15";export{m as BarcodeDetectorPolyfill,f as Orientation,g as ZBAR_WASM_PKG_NAME,u as ZBAR_WASM_REPOSITORY,A as ZBAR_WASM_VERSION,o as ZBarConfig};

